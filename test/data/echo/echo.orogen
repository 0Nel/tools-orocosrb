name 'echo'

import_types_from "echo.h"

task_context 'Echo' do
    extended_state_support

    input_port 'input',   'int'
    input_port 'input_struct',   'echo::Int'
    output_port 'output', 'int'

    method(:write).
        returns('int').
        argument('value', 'int', 'value_arg').
        doc('write_method')

    # This command starts at value and writes it on the output port. Then, it
    # increments the value at each cycle, until stop_value is found on the
    # input port
    command(:AsyncWrite).
	argument('value',  'int', 'value_arg').
	argument('stop', 'int', 'stop_value').
	doc('async_write_command')

    port_driven :input
end

deployment "echo" do
    echo_task = task('echo_Echo', 'Echo').
        periodic 0.05
end

